"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("path"),r=require("express"),t=function(){return t=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},t.apply(this,arguments)};function o(e,r,t){if(t||2===arguments.length)for(var o,n=0,l=r.length;n<l;n++)!o&&n in r||(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))}var n={controllers:new Map,methods:new Map};function l(e,r){if(s(e)){var o=t(t({},a(e)),{controller:e,url:r,middlewares:[]});n.controllers.set(e,o)}else n.controllers.set(e,{controller:e,url:r,middlewares:[]})}function a(e){return n.controllers.get(e)}function s(e){return n.controllers.has(e)}function i(e,r){var o,l;if(u(e,r.handler)){var a=t(t({},c(e,r.handler)),r);null===(o=n.methods.get(e))||void 0===o||o.set(r.handler,a)}else if(n.methods.has(e))null===(l=n.methods.get(e))||void 0===l||l.set(r.handler,r);else{var s=new Map;s.set(r.handler,r),n.methods.set(e,s)}}function c(e,r){var t;if(n.methods.has(e))return null===(t=n.methods.get(e))||void 0===t?void 0:t.get(r)}function d(e){if(n.methods.has(e.prototype))return n.methods.get(e.prototype)}function u(e,r){var t;return Boolean(null===(t=n.methods.get(e))||void 0===t?void 0:t.has(r))}var h=Object.freeze({__proto__:null,repository:n,setController:l,getController:a,hasController:s,setMethod:i,getMethod:c,getMethodList:d,hasMethod:u});function p(e){return function(r){return function(t,o){var n=t[o];i(t,{url:r,method:e,handler:n})}}}var f=p("get"),v=p("post"),m=p("patch"),w=p("put"),g=p("head"),y=p("delete"),x=p("connect"),A=p("options"),M=p("trace");exports.Api=function(){return function(e,r){if(!u(e,e[r]))throw new ReferenceError('Method "'.concat(r,'" cannot be declared as an API because it was not declared as an HTTP method.'));var t=c(e,e[r]);t.isApi=!0,i(e,t)}},exports.Connect=x,exports.Controller=function(e){return function(r){r.prototype._routerURL=e,l(r,e)}},exports.Delete=y,exports.Get=f,exports.Head=g,exports.Middleware=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];function t(r,t){if(t){var n=r;!1===u(n,n[t])&&i(n,{url:"",method:"",handler:n[t]});var d=c(n,n[t]);d.middlewares=Array.isArray(e)?o(o([],(null==d?void 0:d.middlewares)||[],!0),e,!0):o(o([],(null==d?void 0:d.middlewares)||[],!0),[e],!1),i(n,d)}else{var h=r;s(h)&&l(h,"");var p=a(h);p.middlewares=Array.isArray(e)?o(o([],(null==p?void 0:p.middlewares)||[],!0),e,!0):o(o([],(null==p?void 0:p.middlewares)||[],!0),[e],!1),l(h,p.url)}}return t},exports.Options=A,exports.Patch=m,exports.Post=v,exports.Put=w,exports.Trace=M,exports.attachController=function(t,o){var n=r.Router();o.forEach((function(o){var l=a(o);if(!l)throw new ReferenceError('Unregistered controller "'.concat(o.name,'" class.'));var s=r.Router(),i=new l.controller;d(o).forEach((function(r){var t=r.isApi?n:s,o=r.isApi?"".concat(l.url,"/").concat(r.url):r.url,a="/".concat(e.normalize(o).split(/[\\/]/).filter((function(e){return e.match(/\w+/)})).join("/"));t[r.method](a,r.middlewares||[],r.handler.bind(i))})),t.use(l.url,l.middlewares||[],s)})),t.use("/api",n)},exports.respository=h;
//# sourceMappingURL=index.js.map
