import{normalize as e}from"path";import{Router as r}from"express";var t=function(){return t=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},t.apply(this,arguments)};function o(e,r,t){if(t||2===arguments.length)for(var o,n=0,l=r.length;n<l;n++)!o&&n in r||(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))}var n={controllers:new Map,methods:new Map};function l(e,r){if(i(e)){var o=t(t({},a(e)),r);n.controllers.set(e,o)}else n.controllers.set(e,r)}function a(e){return n.controllers.get(e)}function i(e){return n.controllers.has(e)}function s(e,r){var o,l;if(u(e,r.handler)){var a=t(t({},c(e,r.handler)),r);null===(o=n.methods.get(e))||void 0===o||o.set(r.handler,a)}else if(n.methods.has(e))null===(l=n.methods.get(e))||void 0===l||l.set(r.handler,r);else{var i=new Map;i.set(r.handler,r),n.methods.set(e,i)}}function c(e,r){var t;if(n.methods.has(e))return null===(t=n.methods.get(e))||void 0===t?void 0:t.get(r)}function d(e){if(n.methods.has(e.prototype))return n.methods.get(e.prototype)}function u(e,r){var t;return Boolean(null===(t=n.methods.get(e))||void 0===t?void 0:t.has(r))}var h=Object.freeze({__proto__:null,repository:n,setController:l,getController:a,hasController:i,setMethod:s,getMethod:c,getMethodList:d,hasMethod:u});function f(t,o){var n=r();o.forEach((function(o){var l=a(o);if(!l)throw new ReferenceError('Unregistered controller "'.concat(o.name,'" class.'));var i=r(),s=new l.controller;d(o).forEach((function(r){var t=r.isApi?n:i,o=r.isApi?"".concat(l.url,"/").concat(r.url):r.url,a="/".concat(e(o).split(/[\\/]/).filter((function(e){return e.match(/\w+/)})).join("/"));t[r.method](a,r.middlewares||[],r.handler.bind(s))})),t.use(l.url,l.middlewares||[],i)})),t.use("/api",n)}function p(e){return function(r){r.prototype._routerURL=e,l(r,{controller:r,middlewares:[],url:e})}}function v(e){return function(r){return function(t,o){var n=t[o];s(t,{url:r,method:e,handler:n})}}}function m(){return function(e,r){if(!u(e,e[r]))throw new ReferenceError('Method "'.concat(r,'" cannot be declared as an API because it was not declared as an HTTP method.'));var t=c(e,e[r]);t.isApi=!0,s(e,t)}}var w=v("get"),g=v("post"),y=v("patch"),A=v("put"),M=v("head"),b=v("delete"),_=v("connect"),j=v("options"),E=v("trace");function O(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];function t(r,t){if(t){var n=r;!1===u(n,n[t])&&s(n,{url:"",method:"",handler:n[t]});var d=c(n,n[t]);d.middlewares=Array.isArray(e)?o(o([],(null==d?void 0:d.middlewares)||[],!0),e,!0):o(o([],(null==d?void 0:d.middlewares)||[],!0),[e],!1),s(n,d)}else{var h=r;i(h)&&l(h,{controller:h,url:"",middlewares:[]});var f=a(h);f.middlewares=Array.isArray(e)?o(o([],(null==f?void 0:f.middlewares)||[],!0),e,!0):o(o([],(null==f?void 0:f.middlewares)||[],!0),[e],!1),l(h,f)}}return t}export{m as Api,f as AttachController,_ as Connect,p as Controller,b as Delete,w as Get,M as Head,O as Middleware,j as Options,y as Patch,g as Post,A as Put,E as Trace,h as respository};
//# sourceMappingURL=index.js.map
